import{P as c,C as E,j as e,B as C,h as O,M as se,r as z,g as oe}from"./index-36060215.js";import{T as g,P as S,I as le}from"./PageTitle-66c86fbe.js";import{M as re}from"./MainDisplayLayout-22058112.js";import{f as V,a as ne,g as de,b as te}from"./PenalizedTransacStatusConstantHelper-7fea81e0.js";import{D as pe,d as ce}from"./EditRounded-656060b9.js";import{u as xe,a as he}from"./useGetSpecificResource-d827c7df.js";import{E as k}from"./ErrorSnackbar-68b55082.js";import{C as ue,D as A,a as me}from"./CustomModal-fc4ee557.js";import{T as ye,a as fe,b as q,c as je,d as b,f as ge,e as be,g as we}from"./BorrowedItemStatusConstantHelper-916d5fea.js";import{f as Pe}from"./BorrowPurposeConstantHelper-9c404c95.js";import{u as Se}from"./usePatch-2926346d.js";import{C as G,u as _e}from"./index.esm-b331fc7d.js";import{S as Ce}from"./SuccessSnackbar-7dee1494.js";import{T as F}from"./TextField-f244debb.js";import{I as ve}from"./createSvgIcon-be983189.js";import{E as Te}from"./EmptyItems-e01b3d4b.js";import{B as Ee}from"./Box-c89578f5.js";import"./Popover-0a4585bd.js";import"./Typography-24d6f046.js";import"./extendSxProp-5febf8e6.js";import"./SidebarStore-a30a0086.js";import"./Autocomplete-08065e48.js";import"./MenuItem-4910f06d.js";import"./List-0f24711b.js";import"./listItemIconClasses-58278b6e.js";import"./listItemTextClasses-6833b5ce.js";import"./ListItemIcon-a63b79c3.js";import"./Toolbar-f0657326.js";import"./Checkbox-753c00b1.js";import"./SwitchBase-d709e871.js";import"./Switch-00bf4dd1.js";import"./BORROW_PURPOSES-6419a447.js";const $="/penalized-transaction",Me=i=>`${$}/${i}`,Ie=i=>`/penalized-transaction/${i}/mark-as-paid`,T=["ID","Item","Penalty","Start Date","End Date","Date Returned","Status"],P={padding:"12px 12px 12px 0",margin:0,fontSize:"0.875rem",whiteSpace:"nowrap"},Y=({items:i})=>{const{neutralMain:h}=E();return e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs(ye,{sx:{minWidth:"400px"},"aria-label":"borrowed items table",children:[e.jsx(fe,{children:e.jsx(q,{children:T==null?void 0:T.map((o,d)=>e.jsx(g,{style:{padding:`0 ${d===T.length-1?"0":"12px"} 12px 0`,margin:0,fontSize:"0.875rem",whiteSpace:"nowrap",fontWeight:"700",color:h},children:o},o))})}),e.jsx(je,{children:i==null?void 0:i.map((o,d)=>{var u;return e.jsxs(q,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(g,{component:"th",scope:"row",style:{...P,color:h},children:o==null?void 0:o.apc_item_id}),e.jsx(g,{component:"th",scope:"row",style:P,children:o==null?void 0:o.model_name}),e.jsx(g,{component:"th",scope:"row",style:P,children:V(o==null?void 0:o.penalty)}),e.jsx(g,{component:"th",scope:"row",style:P,children:b(o==null?void 0:o.start_date)}),e.jsx(g,{component:"th",scope:"row",style:P,children:b(o==null?void 0:o.due_date)}),e.jsx(g,{component:"th",scope:"row",style:P,children:b(o==null?void 0:o.date_returned)}),e.jsx(g,{component:"th",scope:"row",style:P,children:e.jsx(ue,{label:(u=ge(o==null?void 0:o.status))==null?void 0:u.status,size:"small",variant:"outlined",color:"primary"})})]},d)})})]})})};Y.propTypes={items:c.array.isRequired};const H=({transacData:i,control:h,isPatchLoading:o,handleConfirm:d,onCloseModal:u})=>{const{neutralMain:r,neuetralBackground:t}=E(),p={display:"flex",flexDirection:"row",alignItems:"start"},s={fontWeight:"700",padding:0,margin:0,whiteSpace:"nowrap",minWidth:"110px",fontSize:"0.875rem",color:r},f={padding:0,margin:0,fontSize:"0.875rem",color:r};return e.jsxs(e.Fragment,{children:[e.jsx(A,{textAlign:"left",sx:{"&:before":{width:0},"& .MuiDivider-wrapper":{padding:"0 16px 0 0"}},children:e.jsx(S,{fontSize:"1rem",children:"Payment Details"})}),(i==null?void 0:i.penalty_status)!=="UNPAID"&&(i==null?void 0:i.penalty_status)!=="PENDING_PAYMENT"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:p,children:[e.jsx("p",{style:s,children:"Receipt"}),e.jsx("p",{style:f,children:i==null?void 0:i.receipt_number})]}),e.jsxs("div",{style:p,children:[e.jsx("p",{style:s,children:"Settled On"}),e.jsx("p",{style:f,children:b(i==null?void 0:i.paid_at)||b(i==null?void 0:i.settled_at)})]}),e.jsxs("div",{style:p,children:[e.jsx("p",{style:s,children:"Remarks"}),e.jsx("p",{style:f,children:(i==null?void 0:i.remarks_by_finance_supervisor)||(i==null?void 0:i.remarks_by_cashier)||"n/a"})]})]}),((i==null?void 0:i.penalty_status)==="UNPAID"||(i==null?void 0:i.penalty_status)==="PENDING_PAYMENT")&&e.jsxs("form",{style:{width:"100%",display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx(G,{name:"receipt_number",control:h,defaultValue:(i==null?void 0:i.receipt_number)||"",rules:{required:"Receipt number is required",minLength:{value:5,message:"Receipt number should be at least 5 characters"},maxLength:{value:30,message:"Receipt number should not exceed 30 characters"},pattern:{value:/^[a-zA-Z0-9\s-]+$/,message:"Only letters, numbers, and hyphens are allowed."}},render:({field:j,fieldState:n})=>{var m;return e.jsx(F,{...j,label:"Receipt Number",variant:"standard",type:"text",disabled:(i==null?void 0:i.penalty_status)==="PAID"||(i==null?void 0:i.penalty_status)==="SETTLED",error:!!(n!=null&&n.error),helperText:(m=n==null?void 0:n.error)==null?void 0:m.message,sx:{width:"100%"}})}}),e.jsx(G,{name:"remarks",control:h,defaultValue:"",rules:{minLength:{value:5,message:"Remarks should be at least 5 characters"},maxLength:{value:30,message:"Remarks should not exceed 30 characters"},pattern:{value:/^[a-zA-Z0-9\s-]+$/,message:"Only letters, numbers, and hyphens are allowed."}},render:({field:j,fieldState:n})=>{var m;return e.jsx(F,{...j,label:"Cashier Remarks",variant:"standard",type:"text",disabled:(i==null?void 0:i.penalty_status)==="PAID"||(i==null?void 0:i.penalty_status)==="SETTLED",error:!!(n!=null&&n.error),helperText:(m=n==null?void 0:n.error)==null?void 0:m.message,sx:{width:"100%"}})}}),(i==null?void 0:i.penalty_status)!=="PAID"&&(i==null?void 0:i.penalty_status)!=="SETTLED"&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"},children:[e.jsx(C,{onClick:u,color:"error",children:e.jsx("p",{style:{padding:0,margin:0,fontSize:"0.875rem"},children:"Cancel"})}),e.jsx(C,{onClick:d,color:"success",disabled:o,variant:"contained",children:e.jsx("p",{style:{padding:0,margin:0,fontSize:"0.875rem",color:t},children:"Mark as Paid"})})]})]})]})};H.propTypes={transacData:c.object.isRequired,control:c.object.isRequired,isPatchLoading:c.bool.isRequired,handleConfirm:c.func.isRequired,onCloseModal:c.func.isRequired};const U=({handleSubmit:i,isConfirmationModalOpen:h,closeConfirmationModal:o})=>{const{neutralBackground:d,neutralMain:u}=E(),{isSm:r}=O(),t={padding:0,margin:0,fontSize:"0.875rem",color:u};return e.jsx(se,{open:h,onClose:o,children:e.jsx("div",{style:{display:"flex",flexDirection:"row",height:"100vh",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:d,width:r?"70%":"40%",padding:"18px",borderRadius:"8px"},children:[e.jsx("p",{style:{...t,marginBottom:"12px"},children:"Are you sure you want to mark penalty as paid?"}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(C,{onClick:o,color:"primary",children:e.jsx("p",{style:{padding:0,margin:0,fontSize:"0.875rem"},children:"Cancel"})}),e.jsx(C,{onClick:i,color:"success",variant:"contained",children:e.jsx("p",{style:{padding:0,margin:0,fontSize:"0.875rem"},children:"Confirm"})})]})]})})})};U.propTypes={handleSubmit:c.func.isRequired,isConfirmationModalOpen:c.bool.isRequired,closeConfirmationModal:c.func.isRequired};const X=({specificResource:i,isModalOpen:h,setIsModalOpen:o})=>{const{isSm:d}=O(),{neutralMain:u}=E(),r={display:"flex",flexDirection:"row",alignItems:"start"},t={fontWeight:"700",padding:0,margin:0,whiteSpace:"nowrap",minWidth:"110px",fontSize:"0.875rem",color:u},p={padding:0,margin:0,fontSize:"0.875rem",color:u},s=i==null?void 0:i.transac_data,f=i==null?void 0:i.items,j=s!=null&&s.id?(s==null?void 0:s.id.slice(0,20))+"...":"",n=s!=null&&s.created_at?b(s==null?void 0:s.created_at):"",m=Pe(s==null?void 0:s.purpose),_=ne(s==null?void 0:s.penalty_status),{isPatchSuccess:M,isPatchError:I,isPatchLoading:v,setIsPatchError:l,setIsPatchSuccess:y,handlePatch:w}=Se(),Z=x=>Ie(x),{handleSubmit:J,control:K,trigger:Q,reset:L,getValues:a}=_e(),[B,W]=z.useState(!1),D=()=>{W(!0)},R=()=>{W(!1)},ee=async()=>{let x=a();x&&((x==null?void 0:x.remarks)===null||(x==null?void 0:x.remarks)==="")&&delete x.remarks,await w(Z,s==null?void 0:s.penalized_transac_id,x),R(),L(),v||(o(!1),R())},ie=async()=>{await Q("receipt_number")&&D()};return console.log("penalty status"+(s==null?void 0:s.receipt_number)),e.jsxs(e.Fragment,{children:[e.jsx(me,{isModalOpen:h,setModalOpen:()=>{o(!1),L()},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",padding:d?"20px":"18px",gap:"16px",margin:"auto"},children:[e.jsx(A,{textAlign:"left",sx:{"&:before":{width:0},"& .MuiDivider-wrapper":{padding:"0 16px 0 0"}},children:e.jsx(S,{fontSize:"1rem",children:"Transaction"})}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Request ID"}),e.jsx("p",{style:p,children:d?j:s==null?void 0:s.id}),e.jsx(ve,{onClick:()=>be(s==null?void 0:s.id),sx:{marginLeft:"auto","&:focus":{outline:"none"}},children:e.jsx(we,{sx:{fontSize:"14px"}})})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Borrower"}),e.jsx("p",{style:p,children:s==null?void 0:s.borrower})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Office"}),e.jsx("p",{style:p,children:s==null?void 0:s.department})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Submitted on"}),e.jsx("p",{style:p,children:n})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Purpose"}),e.jsxs("p",{style:p,children:[m==null?void 0:m.purpose,", ",s==null?void 0:s.user_defined_purpose]})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Endorser"}),e.jsx("p",{style:p,children:s!=null&&s.endorser?s==null?void 0:s.endorser:"None"})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Penalty Status"}),e.jsx("p",{style:p,children:_==null?void 0:_.status})]}),e.jsxs("div",{style:r,children:[e.jsx("p",{style:t,children:"Amount"}),e.jsx("p",{style:p,children:s!=null&&s.penalty?V(s==null?void 0:s.penalty):""})]}),e.jsx(A,{textAlign:"left",sx:{"&:before":{width:0},"& .MuiDivider-wrapper":{padding:"0 16px 0 0"},marginTop:"16px"},children:e.jsx(S,{fontSize:"1rem",children:"Requested Items"})}),f&&e.jsx(Y,{items:f}),s&&e.jsx(H,{transacData:s,control:K,isPatchLoading:v,handleConfirm:ie,onCloseModal:()=>o(!1)})]})}),B&&e.jsx(U,{handleSubmit:J(ee),isConfirmationModalOpen:B,closeConfirmationModal:R}),e.jsx(Ce,{isSuccess:M,setIsSuccess:y}),e.jsx(k,{error:I,setError:l})]})};X.propTypes={specificResource:c.object,isModalOpen:c.bool.isRequired,setIsModalOpen:c.func.isRequired};const N=({apiFilter:i})=>{const[h,o]=z.useState(!1),d=[{field:"borrower",headerName:"Borrower",flex:1,minWidth:150},{field:"borrower_apc_id",headerName:"APC ID",flex:1,minWidth:150},{field:"office",headerName:"Office",flex:1,minWidth:100},{field:"penalty_amount",headerName:"Penalty",flex:1,minWidth:100},{field:"actions",headerName:"Actions",flex:.5,minWidth:80,sortable:!1,renderCell:l=>e.jsx(C,{onClick:()=>{var y;v((y=l==null?void 0:l.row)==null?void 0:y.id)},sx:{width:"30px",minWidth:"30px",padding:"8px"},children:e.jsx(ce,{})})}],u=i==="PAID"?[...d.slice(0,-1),{field:"paid_at",headerName:"Settled At",minWidth:150,flex:1,valueGetter:l=>{var y,w;return b((y=l==null?void 0:l.row)==null?void 0:y.paid_at)||b((w=l==null?void 0:l.row)==null?void 0:w.settled_at)}},{field:"facilitated_by",headerName:"Facilitated By",minWidth:150,flex:1,valueGetter:l=>{var y,w;return((y=l==null?void 0:l.row)==null?void 0:y.payment_facilitated_by)||((w=l==null?void 0:l.row)==null?void 0:w.settlement_facilitated_by)}},...d.slice(-1)]:d,{list:r,isGetListLoading:t,isGetListError:p,setIsGetListError:s,getRequestList:f}=xe(),j=$+"?status="+i;console.log(j),z.useEffect(()=>{f(j)},[]);const{specificResource:n,isLoadingSpecificResource:m,isErrorSpecificResource:_,setIsErrorSpecificResource:M,fetchSpecificResource:I}=he(),v=l=>{o(!0),I(Me,l),console.log(n)};return t?e.jsx(oe,{size:"1.5rem"}):!r||(r==null?void 0:r.length)===0?e.jsx(Te,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{width:"100%"},children:e.jsx(pe,{rows:r,columns:u,pageSize:10,checkboxSelection:!0,disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-main":{minWidth:"100%",overflowX:"auto"},"& .nowrap-cell":{whiteSpace:"nowrap"}}})}),(n||!m)&&e.jsx(X,{isModalOpen:h,setIsModalOpen:o,specificResource:n}),e.jsx(k,{error:p,setError:s}),e.jsx(k,{error:_,setError:M})]})};N.propTypes={apiFilter:c.string};const Re=de(),ze=te(),ci=()=>e.jsx(e.Fragment,{children:e.jsx(re,{children:e.jsxs(le,{children:[e.jsx(S,{children:"Penalty Clearance"}),e.jsx(S,{fontSize:"1.2rem",children:"Pending Payment"}),e.jsx(N,{apiFilter:Re}),e.jsx(S,{fontSize:"1.2rem",children:"Settled Penalties"}),e.jsx(N,{apiFilter:ze})]})})});export{ci as default};
