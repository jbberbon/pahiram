import{P as t,C as F,j as e,r as j,f as G,B as k,g as B,h as H}from"./index-d2fd7b75.js";import{M as Y}from"./MainDisplayLayout-b65f4b41.js";import{C as b,a as Z,b as J,u as X}from"./index.esm-75c05ec1.js";import{T as O}from"./TextField-a73f8ee5.js";import{M as S}from"./MenuItem-51c517d3.js";import{u as K,S as ee,a as re,b as se,d as L,D as te,R as ne,c as oe,e as ie}from"./convertDatesToApiFormat-2bb20bb5.js";import{E as C,g as ae}from"./ErrorSnackbar-6e41067a.js";import{B as P}from"./BORROW_PURPOSES-6419a447.js";import{b as le}from"./subtle-prism-5d1a98b4.js";import{T as ue}from"./Typography-8f54e219.js";import{I as A}from"./createSvgIcon-a66e9ade.js";import{D as ce,p as de}from"./CustomModal-8aa409eb.js";import{S as me}from"./SuccessSnackbar-f528902b.js";import{p as pe}from"./borrowRequestEndpoints-e9facb43.js";import"./SidebarStore-01f26900.js";import"./Popover-f1287c58.js";import"./List-f7e23036.js";import"./listItemIconClasses-9c8d7635.js";import"./listItemTextClasses-4b7a5fe5.js";import"./Autocomplete-f478d865.js";import"./extendSxProp-05f00454.js";const T={SELECT_OFFICE:{office:"Select Office",acronym:"S/0",is_lending_office:!1},BMO:{office:"Building Maintenance Office",acronym:"BMO",is_lending_office:!0},ESLO:{office:"Engineering and Science Laboratory Office",acronym:"ESLO",is_lending_office:!0},ITRO:{office:"Information Technology and Resource Office",acronym:"ITRO",is_lending_office:!0},PLO:{office:"Purchasing and Logistics Office",acronym:"PLO",is_lending_office:!1},FAO:{office:"Finance and Accounting Office",acronym:"FAO",is_lending_office:!1},"N/A":{office:"No Designation",acronym:"N/A",is_lending_office:!1}},W=({control:i,items:r,reset:c})=>{const{neutralMain:d}=F(),f=["BMO","ESLO","ITRO"];return e.jsx("div",{style:{width:"100%"},children:e.jsx(b,{name:"department",control:i,defaultValue:"SELECT_OFFICE",rules:{required:"Select an office",validate:a=>a!==T.SELECT_OFFICE.office||"Select Office"},render:({field:a,fieldState:m})=>{var x;return e.jsxs(O,{...a,select:!0,error:!!(m!=null&&m.error),helperText:(x=m==null?void 0:m.error)==null?void 0:x.message,sx:{".MuiOutlinedInput-notchedOutline":{borderStyle:"none"},"& .MuiInputBase-input":{padding:"0"},"& .MuiFormHelperText-root":{margin:0},minWidth:"4rem",maxWidth:"12rem"},onChange:n=>{a.onChange(n),console.log(r),(r||r!==void 0)&&(c(),console.log(r))},children:[e.jsx(S,{disabled:!0,value:"SELECT_OFFICE",children:e.jsx("h2",{style:{fontSize:"1rem",fontWeight:"500",padding:"4px 0",margin:0,color:d},children:"Select Office"})}),f.map(n=>e.jsx(S,{value:T[n].acronym,children:e.jsx("h2",{style:{fontSize:"1rem",fontWeight:"500",padding:"4px 0",margin:0,color:d},children:T[n].acronym})},T[n].acronym))]})}})})};W.propTypes={control:t.object.isRequired,office:t.any,items:t.array,setValue:t.func.isRequired,reset:t.func.isRequired};const V=({control:i,isOfficeSelected:r,setValue:c})=>{const[d,f]=j.useState(""),{results:a,loading:m,error:x,setError:n}=K(d,r),s=Object.keys(P);return e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:"16px",marginBottom:"24px"},children:[e.jsx(b,{name:"endorsed_by",control:i,defaultValue:"",rules:{maxLength:{value:30,message:"Endorser Name should not exceed 30 characters"},pattern:{value:/^[a-zA-Z0-9\s-]+$/,message:"Invalid input. Only letters, numbers, and hyphens are allowed."}},render:({field:h,fieldState:l})=>e.jsx(ee,{disabled:!r,field:h,fieldState:l,setSearchInput:f,label:"Search Endorser",options:a,loading:m,setValue:c,placeholder:"Enter endorser name"})}),e.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[e.jsx(b,{name:"purpose",control:i,defaultValue:"",rules:{required:"Purpose is required"},render:({field:h,fieldState:l})=>{var p;return e.jsx(O,{...h,label:"Select Purpose",variant:"standard",select:!0,disabled:!r,error:!!(l!=null&&l.error),helperText:(p=l==null?void 0:l.error)==null?void 0:p.message,sx:{flex:"1 1 15rem"},children:s.map(g=>e.jsx(S,{value:g,children:P[g].purpose},g))})}}),e.jsx(b,{name:"user_defined_purpose",control:i,defaultValue:"",rules:{required:"Purpose is required",minLength:{value:5,message:"Purpose should be at least 5 characters"},maxLength:{value:30,message:"Purpose should not exceed 30 characters"},pattern:{value:/^[a-zA-Z0-9\s-]+$/,message:"Invalid input. Only letters, numbers, and hyphens are allowed."}},render:({field:h,fieldState:l})=>{var p;return e.jsx(O,{...h,label:"Specify Purpose",variant:"standard",type:"text",disabled:!r,error:!!(l!=null&&l.error),helperText:(p=l==null?void 0:l.error)==null?void 0:p.message,sx:{flex:"1 1 15rem"}})}})]}),e.jsx(C,{error:x,setError:n})]})};V.propTypes={control:t.object.isRequired,isOfficeSelected:t.bool.isRequired,endorser:t.any,setValue:t.func.isRequired};const $=({isMd:i})=>{const[r]=G(),c=r.palette.secondary.main;return e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:i?"center":"flex-start",width:"100%",backgroundColor:c,padding:"16px",borderRadius:"8px",background:`url(${le})`},children:e.jsx(ue,{component:"h1",variant:"h4",color:"white",fontWeight:700,children:"Borrower`s Form"})})};$.propTypes={isMd:t.any.isRequired};const D=({addFieldCount:i,isOfficeSelected:r})=>{const{neutralMain:c}=F();return e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontSize:"1rem",fontWeight:"500",padding:"4px 0",margin:0,color:c},children:"Choose Items"}),e.jsx(k,{onClick:i,variant:"text",disabled:!r,disableElevation:!0,disableRipple:!0,sx:{padding:"8px 8px",margin:0,"&:focus":{outline:"none"}},children:e.jsx("p",{style:{margin:0,fontWeight:"500"},children:"Add fields"})})]})};D.propTypes={addFieldCount:t.func.isRequired,isOfficeSelected:t.bool.isRequired};const xe=(i,r)=>J({control:i,name:r}),z=({control:i,index:r,isOfficeSelected:c,results:d,loading:f,setValue:a,subtractFieldCount:m})=>{const{neutralMain:x}=F(),{bookedDates:n,isLoading:s,isError:h,setIsError:l,getRequestList:p}=re(),g=xe(i,`items[${r}].item_group_id`),[_,M]=j.useState(!1),R=()=>{M(u=>!u)},{remove:I}=Z({control:i,name:"items"}),q=u=>{I(u),m()};return e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"16px"},children:[e.jsx(b,{name:`items[${r}].item_group_id`,control:i,defaultValue:"",rules:{required:"Item is required",pattern:{value:/^[a-zA-Z0-9\s-]+$/,message:"Only letters, numbers, and hyphens are allowed."}},render:({field:u,fieldState:o})=>e.jsx("div",{style:{flex:"1 1 15rem"},children:e.jsx(se,{disabled:!c,field:u,fieldState:o,label:"Search Item",options:d,loading:f,setValue:a,placeholder:"Enter item name"})})}),e.jsx(b,{name:`items[${r}].quantity`,control:i,defaultValue:1,rules:{required:"Quantity is required",min:{value:1,message:"Quantity must be at least 1"},max:{value:3,message:"Quantity cannot exceed 3"}},render:({field:u,fieldState:o})=>{var y;return e.jsx(O,{...u,label:"Quantity",type:"number",variant:"standard",fullWidth:!0,error:!!(o!=null&&o.error),helperText:(y=o==null?void 0:o.error)==null?void 0:y.message,sx:{flex:"1 1 2rem"}})}}),e.jsx(b,{name:`items[${r}].start_date`,control:i,defaultValue:"",rules:{required:"Start date is required"},render:({field:u,fieldState:o})=>{var y;return e.jsx(O,{...u,label:"Select Item Start Date",InputLabelProps:{shrink:!0},id:"select-return-date",type:"datetime-local",variant:"standard",error:!!(o!=null&&o.error),helperText:(y=o==null?void 0:o.error)==null?void 0:y.message,inputProps:{readOnly:!0},disabled:!g,InputProps:{endAdornment:e.jsx(A,{disabled:!g,onClick:()=>{p(g),setTimeout(()=>{s||R()},500)},sx:{padding:0},disableRipple:!0,children:s?e.jsx(B,{size:"1rem"}):e.jsx(L,{sx:{color:x}})})},sx:{flex:"1 1 10rem",'& input[type="datetime-local"]::-webkit-calendar-picker-indicator':{display:"none"}}})}}),e.jsx(b,{name:`items[${r}].return_date`,control:i,defaultValue:"",rules:{required:"Return date is required"},render:({field:u,fieldState:o})=>{var y;return e.jsx(O,{...u,label:"Select Item Return Date",InputLabelProps:{shrink:!0},id:"select-return-date",type:"datetime-local",variant:"standard",error:!!(o!=null&&o.error),helperText:(y=o==null?void 0:o.error)==null?void 0:y.message,inputProps:{readOnly:!0},disabled:!g,InputProps:{endAdornment:e.jsx(A,{disabled:!g,onClick:()=>{p(g),setTimeout(()=>{s||R()},500)},sx:{padding:0},disableRipple:!0,children:s?e.jsx(B,{size:"1rem"}):e.jsx(L,{sx:{color:x}})})},sx:{flex:"1 1 10rem",'& input[type="datetime-local"]::-webkit-calendar-picker-indicator':{display:"none"}}})}}),g&&(n==null?void 0:n.dates)&&e.jsx(te,{isModalOpen:_,setModalOpen:R,setStartDate:u=>{console.log("NEW START DATE",u),a(`items[${r}].start_date`,u)},setEndDate:u=>{console.log("NEW RETURN DATE",u),a(`items[${r}].return_date`,u)},itemGroupId:g,bookedDates:n==null?void 0:n.dates,activeItemCount:n==null?void 0:n.active_items,modelName:n==null?void 0:n.item_model}),e.jsx(ne,{handleRemoveField:()=>q(r)}),e.jsx(ce,{sx:{width:"100%",paddingTop:"16px"}}),e.jsx(C,{error:h,setError:l})]},r)};z.propTypes={control:t.object.isRequired,index:t.number.isRequired,isOfficeSelected:t.bool.isRequired,results:t.array.isRequired,loading:t.bool.isRequired,setValue:t.func.isRequired,subtractFieldCount:t.func.isRequired};const N=({control:i,fieldCount:r,subtractFieldCount:c,isOfficeSelected:d,setValue:f,selectedOffice:a})=>{const{results:m,loading:x,error:n,setError:s}=oe(a,d);return d&&e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:"16px"},children:[[...Array(r).keys()].map(h=>e.jsx(z,{control:i,index:h,isOfficeSelected:d,results:m,loading:x,setValue:f,subtractFieldCount:c},h)),e.jsx(C,{error:n,setError:s})]})};N.propTypes={control:t.object.isRequired,fieldCount:t.number.isRequired,subtractFieldCount:t.func.isRequired,isOfficeSelected:t.bool.isRequired,setValue:t.func.isRequired,getValues:t.func.isRequired,selectedOffice:t.string,items:t.array};const ge=()=>{const[i,r]=j.useState(null),[c,d]=j.useState(!1),[f,a]=j.useState(null);return{isSubmitSuccess:f,isSubmitError:i,isSubmitLoading:c,setSubmitError:r,setSubmitSuccess:a,handleSubmitRequest:async x=>{const n=pe;try{d(!0);const s=await de(n,x);if((s==null?void 0:s.status)===!1){r(s.message),d(!1);return}console.log("HOY "+(s==null?void 0:s.message)),a(s==null?void 0:s.message),console.log("HOYY2 "+f),d(!1)}catch(s){console.error(s),r("An error occurred while processing the request."),d(!1)}}}},Ae=()=>{const{neutralBackground:i,neutralMain:r}=F(),{isSm:c}=H(),{handleSubmit:d,control:f,watch:a,setValue:m,reset:x,getValues:n}=X(),s=a("department"),h=a("endorsed_by"),l=a("items"),[p,g]=j.useState(1),_=()=>{p<10?(g(p+1),console.log(p)):console.log("Max 10 fields")},M=()=>{p>1?(g(p-1),console.log(p)):console.log("Min 1 field")},[R,I]=j.useState(!1),{isSubmitSuccess:q,isSubmitError:u,isSubmitLoading:o,setSubmitError:y,setSubmitSuccess:w,handleSubmitRequest:U}=ge(),Q=async v=>{const E=ie(v);console.log(E),E.endorsed_by?E.apcis_token=ae():delete E.endorsed_by,await U(E)};return j.useEffect(()=>{let v;return q&&(I(!0),v=setTimeout(()=>{x(),w(null),window.location.reload()},3e3)),()=>{clearTimeout(v),I(!1)}},[q,x,w]),e.jsxs(Y,{children:[e.jsxs("form",{onSubmit:d(Q),style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:i,padding:"16px",width:"100%",gap:"24px",boxShadow:"4px 4px 7px 2px rgba(0,0,0,0.1)",borderRadius:"8px"},children:[e.jsx($,{isMd:c}),e.jsx(W,{control:f,items:l,setValue:m,reset:x}),e.jsx(V,{control:f,isOfficeSelected:!!s,endorser:h,setValue:m}),e.jsx(D,{addFieldCount:_,isOfficeSelected:!!s}),e.jsx(N,{control:f,fieldCount:p,subtractFieldCount:M,isOfficeSelected:!!s,setValue:m,getValues:n,watch:a,selectedOffice:s,items:l}),e.jsx(k,{variant:"contained",type:"submit",disabled:!s||o||R,disableElevation:!0,sx:{width:c?"100%":"25%",marginLeft:c?"0":"auto","&:focus":{outline:"none"}},children:e.jsx("p",{style:{fontWeight:"600",margin:0,padding:"2px 0",color:"white"},children:o||R?"Loading":"Submit Request"})})]}),e.jsx(me,{isSuccess:q,setIsSuccess:w,successMessage:"Successfully submitted request",errorMessage:"Failed to submit request"}),e.jsx(C,{error:u,setError:y})]})};export{Ae as default};
